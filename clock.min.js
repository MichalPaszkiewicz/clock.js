Date.prototype.addHours=function(t){return this.setHours(this.getHours()+t),this},Date.prototype.addMinutes=function(t){return this.setMinutes(this.getMinutes()+t),this},Date.prototype.addSeconds=function(t){return this.setSeconds(this.getSeconds()+t),this};var clock=function(t,n){var e=this;e.canvas=document.getElementById(t),e.context=e.canvas.getContext("2d"),e.options={radius:function(){return Math.min(e.canvas.height,e.canvas.width)/2},rim:function(){return.2*i("radius")},rimColour:"rgba(0,0,0,0.1)",x:function(){return e.canvas.width/2},y:function(){return e.canvas.height/2},colour:"rgba(255,0,0,0.2)",lineColour:function(){return e.options.colour},fillColour:function(){return e.options.colour},lineWidth:1,centreCircle:!0,centreCircleRadius:function(){return.03*i("radius")},centreCircleColour:function(){return i("colour")},centreCircleCutout:function(){return.01*i("radius")},date:new Date,addHours:0,addMinutes:0,addSeconds:0,directionCoefficient:1},e.hands={secondHand:{length:1,width:.1,percentile:function(){return(i("date",function(){return new Date}).getSeconds()+i("date").getMilliseconds()/1e3)/60}},minuteHand:{length:.9,width:.4,percentile:function(){return(i("date",function(){return new Date}).getMinutes()+i("date").getSeconds()/60)/60}},hourHand:{length:.5,width:.9,percentile:function(){return(i("date",function(){return new Date}).getHours()+i("date").getMinutes()/60)/12}}};for(var o in n)n.hasOwnProperty(o)&&(e.options[o]=n[o]);var i=function(t,n){if(null==t){if(null==n)throw new Error("No value set for this option.");return"function"==typeof n?n():"function"==typeof e.options[n]?e.options[n]():e.options[n]}if(null==e.options)throw new Error("Someone has deleted the clock's options. Uh-oh!");if("function"==typeof e.options[t]){var o=e.options[t]();return null!=o?o:"function"==typeof n?n():"function"==typeof e.options[n]?e.options[n]():e.options[n]}return e.options[t]},r=function(t,n,o,i,r){e.context.lineWidth=1,e.context.beginPath(),e.context.moveTo(t,n);var c=null!=r?r:.5,a={x:t+2*o/8*Math.cos(i+c),y:n+2*o/8*Math.sin(i+c)},u={x:t,y:n},s={x:t+2*o/8*Math.cos(i-c),y:n+2*o/8*Math.sin(i-c)},d=t+o*Math.cos(i),h=n+o*Math.sin(i);e.context.bezierCurveTo(a.x,a.y,u.x,u.y,d,h),e.context.bezierCurveTo(u.x,u.y,s.x,s.y,t,n),e.context.stroke(),e.context.fill(),e.context.lineWidth=1},c=function(){e.options.date=new Date,e.options.date.addHours(i("addHours",function(){return 0})),e.options.date.addMinutes(i("addMinutes",function(){return 0})),e.options.date.addSeconds(i("addSeconds",function(){return 0}))};return e.update=function(){e.canvas.height=e.canvas.parentNode.offsetHeight,e.canvas.width=e.canvas.parentNode.offsetWidth;var t=i("radius"),n=i("x"),o=i("y");e.context.clearRect(0,0,e.canvas.width,e.canvas.height),e.context.strokeStyle=i("rimColour"),e.context.lineWidth=i("rim"),e.context.beginPath(),e.context.arc(n,o,t-i("rim")/2,0,2*Math.PI),e.context.stroke(),e.context.strokeStyle=i("lineColour"),e.context.fillStyle=i("fillColour"),e.context.lineWidth=i("lineWidth"),c();var a=i("directionCoefficient",function(){return 1});for(var u in e.hands)if(e.hands.hasOwnProperty(u)){var s=a*e.hands[u].percentile()*2*Math.PI-Math.PI/2,d=t*e.hands[u].length;r(n,o,d,s,e.hands[u].width)}i("centreCircle")&&(e.context.beginPath(),e.context.fillStyle=i("centreCircleColour","colour"),e.context.arc(n,o,i("centreCircleRadius"),0,2*Math.PI),e.context.fill(),e.context.stroke(),e.context.beginPath(),e.context.arc(n,o,i("centreCircleCutout"),0,2*Math.PI),e.context.clip(),e.context.clearRect(0,0,e.canvas.width,e.canvas.height)),window.requestAnimationFrame(e.update)},e.start=function(){e.update()},e};
